     1                                  STDIN equ 0
     2                                  STDOUT equ 1
     3                                  STDERR equ 2
     4                                  
     5                                  SYS_READ equ 0
     6                                  SYS_WRITE equ 1
     7                                  SYS_EXIT equ 60
     8                                  
     9                                  NEW_LINE equ 10
    10                                  ZERO equ 0
    11                                  ASCII_ZERO equ '0'
    12                                  ASCII_NINE equ '9'
    13                                  
    14                                  ASCII_A equ 'a'
    15                                  ASCII_Z equ 'z'
    16                                  
    17                                  LINE_SIZE equ 128
    18                                  DIGIT_SIZE equ 128
    19                                  POS_SIZE equ 8
    20                                  
    21                                  section .data
    22 00000000 456E7465722061206C-     	prompt db "Enter a line: ", ZERO
    22 00000009 696E653A2000       
    23 0000000F 596F75206861766520-     	lineMarker db "You have entered: ", ZERO
    23 00000018 656E74657265643A20-
    23 00000021 00                 
    24 00000022 0A00                    	newLine db NEW_LINE, ZERO
    25 00000024 53756D206F66206469-     	digitsSumMarker db "Sum of digits in this line: ", ZERO
    25 0000002D 6769747320696E2074-
    25 00000036 686973206C696E653A-
    25 0000003F 2000               
    26 00000041 4E756D626572206F66-     	charactersCountMarker db "Number of characters in this line: ", ZERO
    26 0000004A 206368617261637465-
    26 00000053 727320696E20746869-
    26 0000005C 73206C696E653A2000 
    27 00000065 52756E6E696E672070-     	positiveMarker db "Running positive condition process...", ZERO
    27 0000006E 6F7369746976652063-
    27 00000077 6F6E646974696F6E20-
    27 00000080 70726F636573732E2E-
    27 00000089 2E00               
    28 0000008B 52756E6E696E67206E-     	negativeMarker db "Running negative condition process...", ZERO
    28 00000094 656761746976652063-
    28 0000009D 6F6E646974696F6E20-
    28 000000A6 70726F636573732E2E-
    28 000000AF 2E00               
    29 000000B1 526573756C743A2000      	resultMarker db "Result: ", ZERO
    30                                  
    31                                  section .bss
    32 00000000 <res 00000080>          	line resb LINE_SIZE
    33 00000080 <res 00000080>          	digit resb DIGIT_SIZE
    34 00000100 <res 00000008>          	digitPos resb POS_SIZE
    35                                  
    36                                  section .text
    37                                  	global _start
    38                                  
    39                                  %macro exit 0
    40                                  	mov rax, SYS_EXIT
    41                                  	mov rdi, ZERO
    42                                  	syscall
    43                                  %endmacro
    44                                  
    45                                  _start:
    46 00000000 48B8-                   	mov rax, prompt
    46 00000002 [0000000000000000] 
    47 0000000A E81E010000              	call _print
    48                                  
    49 0000000F E83F010000              	call _getLine
    50                                  
    51 00000014 48B8-                   	mov rax, lineMarker
    51 00000016 [0F00000000000000] 
    52 0000001E E80A010000              	call _print
    53                                  	
    54 00000023 48B8-                   	mov rax, line
    54 00000025 [0000000000000000] 
    55 0000002D E8FB000000              	call _print
    56                                  
    57 00000032 48B8-                   	mov rax, newLine
    57 00000034 [2200000000000000] 
    58 0000003C E8EC000000              	call _print
    59                                  
    60 00000041 48B8-                   	mov rax, digitsSumMarker
    60 00000043 [2400000000000000] 
    61 0000004B E8DD000000              	call _print
    62                                  
    63 00000050 48B8-                   	mov rax, line
    63 00000052 [0000000000000000] 
    64 0000005A E810010000              	call _digitsSumCount
    65 0000005F 4989C0                  	mov r8, rax
    66 00000062 E838010000              	call _printRAX
    67                                  
    68 00000067 48B8-                   	mov rax, charactersCountMarker
    68 00000069 [4100000000000000] 
    69 00000071 E8B7000000              	call _print
    70                                  
    71 00000076 48B8-                   	mov rax, line
    71 00000078 [0000000000000000] 
    72 00000080 E89E010000              	call _charactersCount
    73                                  	
    74 00000085 4C39C0                  	cmp rax, r8
    75 00000088 7402                    	je _positiveCondition
    76                                  
    77 0000008A EB25                    	jmp _negativeCondition
    78                                  
    79                                  _positiveCondition:
    80 0000008C E80E010000              	call _printRAX
    81 00000091 48B8-                   	mov rax, positiveMarker
    81 00000093 [6500000000000000] 
    82 0000009B E88D000000              	call _print
    83                                  
    84 000000A0 48B8-                   	mov rax, line
    84 000000A2 [0000000000000000] 
    85 000000AA E8A2010000              	call _positiveConditionProcess
    86 000000AF EB25                    	jmp _end
    87                                  
    88                                  _negativeCondition:
    89 000000B1 E8E9000000              	call _printRAX
    90 000000B6 48B8-                   	mov rax, negativeMarker
    90 000000B8 [8B00000000000000] 
    91 000000C0 E868000000              	call _print
    92                                  
    93 000000C5 48B8-                   	mov rax, line
    93 000000C7 [0000000000000000] 
    94 000000CF E8AB010000              	call _negativeConditionProcess
    95 000000D4 EB00                    	jmp _end
    96                                  
    97                                  _end:
    98 000000D6 48B8-                   	mov rax, newLine
    98 000000D8 [2200000000000000] 
    99 000000E0 E848000000              	call _print
   100                                  
   101 000000E5 48B8-                   	mov rax, newLine
   101 000000E7 [2200000000000000] 
   102 000000EF E839000000              	call _print
   103                                  
   104 000000F4 48B8-                   	mov rax, resultMarker
   104 000000F6 [B100000000000000] 
   105 000000FE E82A000000              	call _print
   106                                  
   107 00000103 48B8-                   	mov rax, line
   107 00000105 [0000000000000000] 
   108 0000010D E81B000000              	call _print
   109                                  
   110 00000112 48B8-                   	mov rax, newLine
   110 00000114 [2200000000000000] 
   111 0000011C E80C000000              	call _print
   112                                  
   113                                  	exit
   113 00000121 B83C000000          <1>  mov rax, SYS_EXIT
   113 00000126 BF00000000          <1>  mov rdi, ZERO
   113 0000012B 0F05                <1>  syscall
   114                                  
   115                                  _print:
   116 0000012D 50                      	push rax
   117 0000012E BB00000000              	mov rbx, ZERO
   118                                  
   119                                  _printLoop:
   120 00000133 8A08                    	mov cl, [rax]
   121                                  
   122 00000135 80F900                  	cmp cl, ZERO
   123 00000138 7408                    	je _printExit
   124                                  
   125 0000013A 48FFC0                  	inc rax
   126 0000013D 48FFC3                  	inc rbx
   127 00000140 EBF1                    	jmp _printLoop
   128                                  
   129                                  _printExit:
   130 00000142 B801000000              	mov rax, SYS_WRITE
   131 00000147 BF01000000              	mov rdi, STDOUT
   132 0000014C 5E                      	pop rsi
   133 0000014D 4889DA                  	mov rdx, rbx
   134 00000150 0F05                    	syscall
   135 00000152 C3                      	ret
   136                                  
   137                                  _getLine:
   138 00000153 B800000000              	mov rax, SYS_READ
   139 00000158 BF00000000              	mov rdi, STDIN
   140 0000015D 48BE-                   	mov rsi, line
   140 0000015F [0000000000000000] 
   141 00000167 BA80000000              	mov rdx, LINE_SIZE
   142 0000016C 0F05                    	syscall
   143 0000016E C3                      	ret
   144                                  
   145                                  _digitsSumCount:
   146 0000016F 4889C3                  	mov rbx, rax
   147 00000172 B800000000              	mov rax, ZERO
   148                                  
   149                                  _digitsSumCountLoop:
   150 00000177 B900000000              	mov rcx, ZERO
   151 0000017C 8A0B                    	mov cl, [rbx]
   152                                  
   153 0000017E 80F900                  	cmp cl, ZERO
   154 00000181 741B                    	je _digitsSumCountExit
   155                                  
   156 00000183 80F90A                  	cmp cl, NEW_LINE
   157 00000186 7416                    	je _digitsSumCountExit
   158                                  
   159 00000188 48FFC3                  	inc rbx
   160                                  
   161 0000018B 80F930                  	cmp cl, ASCII_ZERO
   162 0000018E 7CE7                    	jl _digitsSumCountLoop
   163                                  
   164 00000190 80F939                  	cmp cl, ASCII_NINE
   165 00000193 7FE2                    	jg _digitsSumCountLoop
   166                                  
   167 00000195 4801C8                  	add rax, rcx
   168 00000198 4883E830                	sub rax, ASCII_ZERO
   169                                  
   170 0000019C EBD9                    	jmp _digitsSumCountLoop
   171                                  
   172                                  _digitsSumCountExit:
   173 0000019E C3                      	ret
   174                                  
   175                                  _printRAX:
   176 0000019F 48B9-                   	mov rcx, digit
   176 000001A1 [8000000000000000] 
   177 000001A9 BB0A000000              	mov rbx, NEW_LINE
   178 000001AE 488919                  	mov [rcx], rbx
   179 000001B1 48FFC1                  	inc rcx
   180 000001B4 48890C25[00010000]      	mov [digitPos], rcx
   181                                  
   182                                  _printRAXMakingLoop:
   183 000001BC BA00000000              	mov rdx, ZERO
   184 000001C1 BB0A000000              	mov rbx, 10
   185 000001C6 48F7F3                  	div rbx
   186 000001C9 50                      	push rax
   187 000001CA 4883C230                	add rdx, ASCII_ZERO
   188                                  
   189 000001CE 488B0C25[00010000]      	mov rcx, [digitPos]
   190 000001D6 8811                    	mov [rcx], dl
   191 000001D8 48FFC1                  	inc rcx
   192 000001DB 48890C25[00010000]      	mov [digitPos], rcx
   193                                  
   194 000001E3 58                      	pop rax
   195 000001E4 4883F800                	cmp rax, ZERO	
   196 000001E8 75D2                    	jne _printRAXMakingLoop
   197                                  
   198                                  _printRAXPrintingLoop:
   199 000001EA 488B0C25[00010000]      	mov rcx, [digitPos]
   200                                  	
   201 000001F2 B801000000              	mov rax, SYS_WRITE
   202 000001F7 BF01000000              	mov rdi, STDOUT
   203 000001FC 4889CE                  	mov rsi, rcx
   204 000001FF BA01000000              	mov rdx, 1
   205 00000204 0F05                    	syscall	
   206                                  
   207 00000206 488B0C25[00010000]      	mov rcx, [digitPos]
   208 0000020E 48FFC9                  	dec rcx
   209 00000211 48890C25[00010000]      	mov [digitPos], rcx
   210                                  
   211 00000219 4881F9[80000000]        	cmp rcx, digit
   212 00000220 7DC8                    	jge _printRAXPrintingLoop
   213                                  
   214 00000222 C3                      	ret
   215                                  
   216                                  _charactersCount:
   217 00000223 4889C3                  	mov rbx, rax
   218 00000226 B800000000              	mov rax, ZERO
   219                                  
   220                                  _charactersCountLoop:
   221 0000022B B900000000              	mov rcx, ZERO
   222 00000230 8A0B                    	mov cl, [rbx]
   223                                  
   224 00000232 80F900                  	cmp cl, ZERO
   225 00000235 7419                    	je _charactersCountExit
   226                                  
   227 00000237 80F90A                  	cmp cl, NEW_LINE
   228 0000023A 7414                    	je _charactersCountExit
   229                                  
   230 0000023C 48FFC3                  	inc rbx
   231                                  
   232 0000023F 80F961                  	cmp cl, ASCII_A
   233 00000242 7CE7                    	jl _charactersCountLoop
   234                                  
   235 00000244 80F97A                  	cmp cl, ASCII_Z
   236 00000247 7FE2                    	jg _charactersCountLoop
   237                                  
   238 00000249 EB00                    	jmp _characterCountRAXIncrement
   239                                  
   240                                  _characterCountRAXIncrement:
   241 0000024B 48FFC0                  	inc rax
   242 0000024E EBDB                    	jmp _charactersCountLoop
   243                                  
   244                                  _charactersCountExit:
   245 00000250 C3                      	ret
   246                                  
   247                                  _positiveConditionProcess:
   248 00000251 BB00000000              	mov rbx, ZERO
   249 00000256 8A18                    	mov bl, [rax]
   250                                  
   251 00000258 80FB00                  	cmp bl, ZERO
   252 0000025B 7421                    	je _positiveExit
   253                                  
   254 0000025D 80FB0A                  	cmp bl, NEW_LINE
   255 00000260 741C                    	je _positiveExit
   256                                  
   257 00000262 80FB30                  	cmp bl, ASCII_ZERO
   258 00000265 7E12                    	jle _positiveRAXIncrement
   259                                  
   260 00000267 80FB39                  	cmp bl, ASCII_NINE
   261 0000026A 7F0D                    	jg _positiveRAXIncrement
   262                                  
   263 0000026C 80EB01                  	sub bl, 1
   264 0000026F 80EB30                  	sub bl, ASCII_ZERO
   265 00000272 80C361                  	add bl, ASCII_A
   266 00000275 8818                    	mov [rax], bl
   267                                  
   268 00000277 EB00                    	jmp _positiveRAXIncrement
   269                                  
   270                                  _positiveRAXIncrement:
   271 00000279 48FFC0                  	inc rax
   272 0000027C EBD3                    	jmp _positiveConditionProcess
   273                                  
   274                                  _positiveExit:
   275 0000027E C3                      	ret
   276                                  
   277                                  _negativeConditionProcess:
   278 0000027F BB00000000              	mov rbx, ZERO
   279 00000284 8A18                    	mov bl, [rax]
   280                                  
   281 00000286 80FB00                  	cmp bl, ZERO
   282 00000289 741D                    	je _negativeExit
   283                                  
   284 0000028B 80FB0A                  	cmp bl, NEW_LINE
   285 0000028E 7418                    	je _negativeExit
   286                                  
   287 00000290 48FFC0                  	inc rax
   288 00000293 8A18                    	mov bl, [rax]
   289                                  
   290 00000295 80FB00                  	cmp bl, ZERO
   291 00000298 740E                    	je _negativeExit
   292                                  
   293 0000029A 80FB0A                  	cmp bl, NEW_LINE
   294 0000029D 7409                    	je _negativeExit
   295                                  
   296 0000029F 50                      	push rax
   297 000002A0 E804000000              	call _moveStringToTheLeft
   298 000002A5 58                      	pop rax
   299                                  
   300 000002A6 EBD7                    	jmp _negativeConditionProcess
   301                                  
   302                                  _negativeExit:
   303 000002A8 C3                      	ret
   304                                  
   305                                  _moveStringToTheLeft:
   306 000002A9 BB00000000              	mov rbx, ZERO
   307 000002AE 50                      	push rax
   308                                  
   309 000002AF 48FFC0                  	inc rax
   310 000002B2 8A18                    	mov bl, [rax]
   311                                  
   312 000002B4 58                      	pop rax
   313 000002B5 8818                    	mov [rax], bl
   314                                  
   315 000002B7 48FFC0                  	inc rax
   316                                  
   317 000002BA 80FB00                  	cmp bl, ZERO
   318 000002BD 7407                    	je _moveStringToTheLeftExit
   319                                  
   320 000002BF 80FB0A                  	cmp bl, NEW_LINE
   321 000002C2 7402                    	je _moveStringToTheLeftExit
   322                                  
   323 000002C4 EBE3                    	jmp _moveStringToTheLeft
   324                                  
   325                                  _moveStringToTheLeftExit:
   326 000002C6 B300                    	mov bl, ZERO
   327 000002C8 488918                  	mov [rax], rbx
   328 000002CB C3                      	ret
